# 🎬 豆瓣电影数据可视分析系统 (Douban Movie Analysis)

欢迎使用豆瓣电影数据可视分析系统！这是一个基于 Python 的实战项目，旨在帮助初学者理解如何**爬取网站数据**、**存储数据**并将其**可视化展示**。

本项目集成了网络爬虫（Spider）、Web开发（Flask）、数据库（SQLite）和数据可视化（ECharts）等多种技术。

---

## 🌟 项目功能亮点

### 1. 数据爬取 (Crawler)
- **Top 250 榜单**：一键爬取豆瓣评分最高的 250 部电影，获取高质量数据。
- **自定义分类**：支持按类型爬取（如“喜剧”、“科幻”），不再局限于榜单。
- **深度信息**：自动抓取电影的**导演**、**主演**、**评分**、**简介**等详细信息。

### 2. 可视化仪表盘 (Dashboard)
- **首页概览**：实时展示收录电影总数、平均分和时间跨度。
- **多维分析**：
    - **类型分布**：通过饼图查看哪种类型的电影最多。
    - **产地分布**：通过柱状图了解电影主要来自哪些国家。
    - **全球地图**：在世界地图上直观展示电影的产地来源。

### 3. 数据探索与导出
- **全库搜索**：支持按**片名**、**导演**、**演员**或**类型**进行模糊搜索。
- **Excel 导出**：一键将数据库中的所有电影数据导出为 Excel 表格，方便二次处理。

---

## 📂 项目结构说明

对于初学者，了解文件结构非常有帮助：

```
douban_movies_top250/
├── app.py                  # [核心] Web 应用的主程序，运行它来启动网页
├── main.py                 # [核心] 数据爬虫的入口，运行它来抓取数据
├── spider/                 # 爬虫模块文件夹
│   └── douban_spider.py    # 具体的爬虫逻辑代码
├── storage/                # 数据存储模块文件夹
│   └── repository.py       # 负责与数据库交互（保存数据）
├── templates/              # [前端] HTML 网页模板文件夹
│   ├── index.html          # 首页仪表盘
│   ├── movie.html          # 电影列表页
│   ├── analysis.html       # 多维分析页 (含地图)
│   ├── search.html         # 搜索结果页
│   └── base.html           # 网页的基础骨架 (导航栏等)
├── static/                 # [前端] 静态资源文件夹
│   └── assets/
│       └── css/            # 样式文件 (控制网页好不好看)
│           └── custom.css  # 我们编写的自定义样式
├── data/                   # 数据存放目录
│   └── movie.db            # SQLite 数据库文件 (自动生成)
└── requirements.txt        # 项目依赖库列表
```

---

## 🚀 快速开始

### 第一步：环境准备
确保你的电脑上安装了 Python（建议 3.8 以上）。在项目根目录下安装依赖：

```bash
pip install -r requirements.txt
```

### 第二步：抓取数据
在启动网站之前，我们需要先抓取一些数据。

**1. 抓取 Top 250 完整榜单 (推荐)**
```bash
python main.py
```
*这会抓取豆瓣 Top 250 的全部 10 页数据。*

**2. (可选) 抓取特定类型，例如“喜剧”**
```bash
python main.py --type tag --tag 喜剧 --no-clear
```
*`--no-clear` 表示保留原有数据，将新数据追加进去。*

### 第三步：启动网站
数据抓取完成后，运行以下命令启动 Web 服务器：

```bash
python app.py
```

### 第四步：访问体验
打开浏览器，访问地址：
👉 **http://127.0.0.1:5000/**

---

## 📖 技术原理解析 (写给初学者)

### 1. 爬虫是怎么工作的？ (`spider/`)
爬虫就像一个自动化的浏览器。它向豆瓣服务器发送请求（Request），拿到网页的代码（HTML），然后像剥洋葱一样分析代码（BeautifulSoup），提取出我们想要的电影名、评分等信息。

### 2. 数据存在哪里？ (`storage/` & `data/`)
我们使用 **SQLite** 数据库。它是一个轻量级的文件数据库，不需要复杂的安装，所有数据都存在 `movie.db` 文件里。`repository.py` 负责把爬到的数据整齐地放进数据库表中。

### 3. 网页是怎么显示的？ (`app.py` & `templates/`)
- **Flask** 是一个 Web 框架，它负责根据用户的网址请求（如 `/search`），去数据库里查数据。
- **Jinja2** 模板引擎负责把查到的数据“填空”到 HTML 文件里（比如把电影名填到表格中）。
- **浏览器** 最终渲染出漂亮的网页给我们看。

### 4. 图表是怎么画出来的？ (`static/`)
我们使用了 **ECharts**，这是一个强大的 JavaScript 图表库。后端（Flask）把统计好的数字传给前端，前端的 JavaScript 代码调用 ECharts 把这些数字画成饼图、地图。

---

## 🛠 常见问题

**Q: 爬取时出现 403 Forbidden 错误？**
A: 豆瓣有反爬机制。我们在 `main.py` 中默认设置了 1 秒的延迟 (`--delay 1.0`) 以降低被封禁风险。如果遇到封禁，请稍等一段时间再试，或尝试更换网络环境。

**Q: 搜索不到刚爬取的电影？**
A: 请确保爬虫脚本 (`main.py`) 成功运行并显示 "Saved ... movies"。然后重启一下 `app.py` 确保应用加载了最新数据。

---
*祝您学习愉快！如果有任何代码上的问题，可以随时查看源码，注释里有很多细节说明。*
